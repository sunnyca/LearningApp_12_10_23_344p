{% extends "intro_flow_2.html" %} {% block title %}Home{% endblock %} {% block
content %}

<html>
  <head>
    <title>Meet George</title>
    <style>
      /* Styling for the layout */
      .container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
      }
      .image-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
      }
      .image {
        width: 200px; /* Adjust the width of the images */
        height: auto; /* Maintain aspect ratio */
        border: 2px solid transparent; /* Initially no border */
        cursor: pointer; /* Change cursor to pointer */
        transition: border 0.3s; /* Add a smooth transition effect */
      }
      .selected {
        border: 2px solid blue; /* Highlight color for selected images */
      }
      .text {
        text-align: center;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div>
      <div>
        George learns best by matching sounds to letters. So far he has learned
        four sounds /i/, /b/, /sh/, and /p/. Lets create some flash cards for
        each of these sounds! Below are some images generated by George, pick
        the one that best matches the sound displayed. If none of them are good,
        click regenerate to get a new set of images. Once you have clicked on an
        image, the flash card will be created. You can check out all created
        flashcards in the Progress Tracker tab.

        <button class="microphone-button" type="submit" onclick="toggleAudio()">
          <i class="fas fa-microphone"></i>
          <!-- Font Awesome volume button icon -->
        </button>
      </div>
      <div>
        <p class="text">
          Lets start with the /sh/ sound. Click on the image that best matches
          the sound. George is trying to draw: {% for char in character %} {{
          char }}{% if not loop.last %}, {% endif %} {% endfor %}.
        </p>
      </div>
      <div>
        <form
          id="imageForm"
          action="/store_image_1"
          method="post"
          onsubmit="showLoading()"
        >
          <div class="image-row">
            {% for i in range(0, 4) %}
            <div class="image-container">
              <label>
                <input
                  type="checkbox"
                  name="selected_image"
                  value="{{ i }}"
                  style="display: none"
                />
                <img
                  class="image"
                  src="{{ url_for('static', filename='images/generated/'+id+'_sh' ~ i ~ '.png') }}"
                  alt="Image {{ i }}"
                />
              </label>
              <p>This is {{ character[i] }}</p>
            </div>
            {% endfor %}
          </div>

          <button
            id="submitButton"
            class="btn btn-primary"
            type="submit"
            disabled
            style="margin-left: 10px"
          >
            Submit
          </button>
        </form>
        <div id="loading" style="display: none; text-align: left">
          <div class="loader"></div>
          <p>Loading...</p>
        </div>
      </div>
      <form
        id="regenerate"
        action="/regenerate"
        method="post"
        value="sh"
        style="margin-left: 10px"
      >
        <!-- Adding margin-left for spacing between buttons -->
        <button
          class="btn btn-primary"
          id="regenerateButton"
          type="submit"
          name="sound"
          value="sh"
        >
          Regenerate
        </button>
      </form>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const images = document.querySelectorAll(".image");
          const audio = new Audio();

          images.forEach((image) => {
            image.addEventListener("click", function () {
              // Remove 'selected' class from all images
              images.forEach((img) => img.classList.remove("selected"));
              // Add 'selected' class to the clicked image
              this.classList.add("selected");
              // Enable the submit button when an image is selected
              document.getElementById("submitButton").disabled = false;

              // Get the selected image number
              const selectedImage = this.getAttribute("src").match(
                new RegExp(id + "_sh(\\d+)\\.png")
              )[1];

              console.log("Selected image:", selectedImage);

              // Set the audio source dynamically based on the selected image
              audio.src =
                "{{ url_for('static', filename='/sounds/generated/character_') }}" +
                selectedImage +
                "_sh.mp3";

              // Play the audio
              audio.play();

              // AJAX POST request to send the selected image number to the server
              fetch("/store_image", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ selected_image: selectedImage }),
              })
                .then((response) => {
                  console.log("Image selection sent to the server");
                })
                .catch((error) => console.error("Error:", error));
            });
          });
        });

        function showLoading() {
          document.getElementById("loading").style.display = "block";
        }
      </script>
    </div>
  </body>
</html>

{% endblock %}
